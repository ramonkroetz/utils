{"version":3,"sources":["../src/browserId.ts","../src/cnpj.ts","../src/cpf.ts","../src/fileValidation.ts"],"sourcesContent":["import Fingerprint from '@fingerprintjs/fingerprintjs'\n\n/** Returns the browser id of the user */\nexport async function getBrowserId() {\n  const fpPromise = await Fingerprint.load()\n  const result = await fpPromise.get()\n  return result.visitorId\n}\n","const CNPJ_REGEX = /^\\d{2}\\.\\d{3}\\.\\d{3}\\/\\d{4}-\\d{2}$/\n\n// Code from https://www.geradorcnpj.com/javascript-validar-testedCnpj.htm\n\n/** Returns whether a CNPJ is valid or not */\nexport function isValidCnpj(cnpj: string | number) {\n  const isMasked = CNPJ_REGEX.test(cnpj.toString())\n  const testedCnpj = isMasked ? cnpj.toString().replace(/[^\\d]+/g, '') : cnpj.toString()\n\n  if (testedCnpj === '') return false\n\n  if (testedCnpj.length !== 14) return false\n\n  const knownInvalidCnpjs = [\n    '00000000000000',\n    '11111111111111',\n    '22222222222222',\n    '33333333333333',\n    '44444444444444',\n    '55555555555555',\n    '66666666666666',\n    '77777777777777',\n    '88888888888888',\n    '99999999999999',\n  ]\n\n  if (knownInvalidCnpjs.includes(testedCnpj)) return false\n\n  // Valida DVs\n  let length = testedCnpj.length - 2\n  let numbers = testedCnpj.substring(0, length)\n  const digits = testedCnpj.substring(length)\n  let sum = 0\n  let position = length - 7\n\n  for (let i = length; i >= 1; i--) {\n    sum += Number(numbers.charAt(length - i)) * position--\n    if (position < 2) position = 9\n  }\n\n  let result = sum % 11 < 2 ? 0 : 11 - (sum % 11)\n  if (result.toString() !== digits.charAt(0)) return false\n\n  length++\n  numbers = testedCnpj.substring(0, length)\n  sum = 0\n  position = length - 7\n  for (let i = length; i >= 1; i--) {\n    sum += Number(numbers.charAt(length - i)) * position--\n    if (position < 2) position = 9\n  }\n\n  result = sum % 11 < 2 ? 0 : 11 - (sum % 11)\n\n  if (result.toString() !== digits.charAt(1)) return false\n\n  return true\n}\n","const CPF_REGEX = /^\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}$/\n\n// Code from http://www.receita.fazenda.gov.br/aplicacoes/atcta/cpf/funcoes.js\n\n/** Returns whether a CPF is valid or not */\nexport function isValidCpf(cpf: string | number) {\n  const isMasked = CPF_REGEX.test(cpf.toString())\n  const testedCpf = isMasked ? cpf.toString().replace(/[^\\d]/g, '') : cpf.toString()\n\n  let sum = 0\n  if (\n    testedCpf === '00000000000' ||\n    testedCpf === '11111111111' ||\n    testedCpf === '22222222222' ||\n    testedCpf === '33333333333' ||\n    testedCpf === '44444444444' ||\n    testedCpf === '55555555555' ||\n    testedCpf === '66666666666' ||\n    testedCpf === '77777777777' ||\n    testedCpf === '88888888888' ||\n    testedCpf === '99999999999'\n  ) {\n    return false\n  }\n\n  for (let i = 1; i <= 9; i++) {\n    sum += Number(testedCpf.substring(i - 1, i)) * (11 - i)\n  }\n\n  let remainder = (sum * 10) % 11\n\n  if (remainder === 10 || remainder === 11) remainder = 0\n  if (remainder !== Number(testedCpf.substring(9, 10))) return false\n\n  sum = 0\n  for (let i = 1; i <= 10; i++) {\n    sum += Number(testedCpf.substring(i - 1, i)) * (12 - i)\n  }\n\n  remainder = (sum * 10) % 11\n\n  if (remainder === 10 || remainder === 11) remainder = 0\n  if (remainder !== Number(testedCpf.substring(10, 11))) return false\n  return true\n}\n","import type { FileValidityAndDataURLResult, MimeType } from './types'\n\nconst MIME_TYPES: Record<MimeType, string[]> = {\n  'image/png': ['89504e47'],\n  'image/jpeg': ['ffd8ffe0', 'ffd8ffe1', 'ffd8ffe2'],\n  'application/pdf': ['255044462d'],\n}\n\nasync function getBlobFileHeader(file: Blob, signatures: string[]) {\n  return new Promise<string>((resolve): void => {\n    const fileReader = new FileReader()\n\n    fileReader.onloadend = (event) => {\n      if (typeof event.target?.result !== 'string') {\n        const biggestSignature = signatures.sort((a, b) => a.length - b.length)[signatures.length - 1]\n\n        const bufferArray = new Uint8Array(event.target?.result || [])\n        const bufferHead = bufferArray.subarray(0, biggestSignature.length / 2)\n        const header = Array.from(bufferHead).reduce((acc, byte) => acc + byte.toString(16), '')\n        resolve(header)\n      } else {\n        resolve('')\n      }\n    }\n\n    fileReader.readAsArrayBuffer(file)\n  })\n}\n\n/**\n * Returns an object containing a property that says if the mime type of given file\n * is valid and a property with the reader data URL\n */\nexport function getFileValidityAndDataURL(file: Blob, type: MimeType) {\n  return new Promise<FileValidityAndDataURLResult>((resolve) => {\n    const reader = new FileReader()\n\n    reader.onloadend = async () => {\n      const signatures = MIME_TYPES[type]\n      const dataURL = reader.result as string\n\n      if (signatures) {\n        const headerString = await getBlobFileHeader(file, signatures)\n\n        const isValid = signatures.some((signature) => headerString.startsWith(signature))\n\n        resolve({ isValid, dataURL })\n      } else {\n        resolve({ isValid: false, dataURL })\n      }\n    }\n\n    reader.readAsDataURL(file)\n  })\n}\n"],"mappings":"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","names":["Fingerprint","getBrowserId","__async","Fingerprint","CNPJ_REGEX","isValidCnpj","cnpj","testedCnpj","length","numbers","digits","sum","position","i","result","CPF_REGEX","isValidCpf","cpf","testedCpf","sum","i","remainder","MIME_TYPES","getBlobFileHeader","file","signatures","__async","resolve","fileReader","event","_a","_b","biggestSignature","a","b","bufferHead","header","acc","byte","getFileValidityAndDataURL","type","reader","dataURL","headerString","isValid","signature"]}